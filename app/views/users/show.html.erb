<div class="container">
  <div class="mypage_box">
    <div class="detail_box_in">

  <div class="row">
    <div class="col-xs-6">

    <div><%= attachment_image_tag @user, :profile_image, :fill, 250, 250, format: 'jpeg', class: "img-circle profile-img", fallback: "no_image.jpg", size:'250x250' %>
    </div>

    <div class="profile_name"><%= @user.name %></div>

    <div id="foll_<%= @user.id %>">
      <%= render "follow_form", user: @user %>
    </div>
    <div>
      <ul class="profile_follow">
        <li class="profile_follow_li">
          <div><%= @user.active_relationships.count %></div>
          <div><%= link_to "フォロー中", follows_user_path(@user.id) %></div>
        </li>
        <li class="profile_follow_li">
          <div><%= @user.passive_relationships.count %></div>
          <div><%= link_to "フォロワー", followers_user_path(@user.id) %></div>
        </li>
        <li class="profile_follow_li">
          <div><%= @posts.count %></div>
          <div>投稿数</div>
        </li>
    </ul>
   </div>



      <div class="profile_box">
        <% unless @user.old.present? || @user.sex.present? || @user.tall.present? || @user.weight.present? || @user.target.present? || @user.introduction? %>
          <%= link_to "プロフィール作成", edit_user_path(@user.id) %>
        <% else %>
      <table>
        <tr>
          <% if @user.old.present? %>
            <td><p><%= @user.old %>歳</p></td>
          <% end %>
          <% if @user.sex.present? %>
            <td><p><%= @user.sex %>性</p></td>
          <% end %>
        </tr>
      <% if user_signed_in? && current_user.id == @user.id %>
      <tr>
        <% if @user.tall.present? %>
        <td><p>身長</p></td>
        <td><p><%= @user.tall %>cm</p></td>
        <% end %>
      </tr>
      <tr>
        <% if @user.weight.present? %>
        <td><p>体重</p></td>
        <td><p><%= @user.weight %>kg</p></td>
        <% end %>
      </tr>
      <tr>
        <% if @user.userbmi.present? %>
          <% if @user.userbmi.nan? %>
            <% else %>
              <td><p>BMI</p></td>
              <td><p><%= @user.userbmi %></p></td>
          <% end %>
        <% end %>
      </tr>
      <tr>
        <% if @user.target.present? %>
        <td><p>目標体重　</p></td>
        <td><p><%= @user.target %>kg</p></td>
        <% end %>
      </tr>
      <% end %>
    </table>
      <p><%= @user.introduction %></p>
    <% end %>
      <button type="button" class="btn btn-primary"><i class="glyphicon glyphicon-cog"></i><%= link_to "Edit Profile", edit_user_path(@user.id)%></button>
    </div>


    </div>
    <div class="col-xs-6">
      <div class="users_post_box">
        <div class="">
        <ul class="new">全ての投稿
          <li class="new_post"><%= link_to "記事投稿へ", new_post_path, class: 'btn btn-success' %></li>
        </ul>
      </div>
        <div class="user_post_kaminari">
          <%= paginate @posts %>
        </div>

      <table class="table">
          <% @posts.each do |post| %>
            <tr>
              <td>
                <p><%= post.created_at.strftime('%Y/%m/%d %H:%M') %>に投稿</p>
                <div class="genre_btn"><span style="background-color:#ffcc99"><%= post.genre.name %></span></div>
                <h5><%= link_to post.title, post_path(post.id) %></h5>
              </td>
            </tr>
          <% end %>
      </table>
      </div>
    </div>
  </div>


  <div class="row">
    <div class="col-xs-6">

<%= month_calendar events: @day_weights do |date, weights| %>
  <%= date.day %>
    <% @day_weights.each do |day_weight| %>
      <% if date.day == day_weight.start_time.day %>
      <% if date.month == day_weight.start_time.month %>
      <% if date.year == day_weight.start_time.year %>
        <div>
          <p><%= link_to day_weight.weight, edit_user_day_weight_path(current_user.id, day_weight.id) %>kg</p>
        </div>
      <% end %>
      <% end %>
      <% end %>
    <% end %>

    <% @day_records.each do |day_record| %>
      <% if date.day == day_record.start_time.day %>
      <% if date.month == day_record.start_time.month %>
      <% if date.year == day_record.start_time.year %>
        <% if day_record.breakfast.present? || day_record.lunch.present? || day_record.dinner.present? || day_record.snack.present? %>
          <%= link_to user_day_record_path(current_user.id, day_record.id) do %>
            <i class="fas fa-apple-alt"></i>
            <% end %>
        <% end %>
          <% if day_record.memo.present? %>
            <%= link_to user_day_record_path(current_user.id, day_record.id) do %>
              <i class="fas fa-pencil-alt"></i>
            <% end %>
          <% end %>
          <% if day_record.training != 0 %>
            <%= link_to user_day_record_path(current_user.id, day_record.id) do %>
              <i class="fas fa-bicycle"></i>
            <% end %>
          <% else %>
          <% end %>
      <% end %>
      <% end %>
      <% end %>
    <% end %>

<% end %>


    </div>

    <div class="col-xs-6">
      <div class="chart_box">
        <div class="record_btn">
          <%= link_to "今日の食事・運動を記録", new_user_day_record_path(@user.id), class: 'btn btn-success' %>
          <%= link_to "今日の体重を記録", new_user_day_weight_path(@user.id), class: 'btn btn-warning' %>
        </div>
        <%= line_chart @weights.chart_date,xtitle: "日付", ytitle: "体重(kg)", width: "500px", height: "400px", colors: ["#ff69b4", "#ff69b4"] %>
      </div>
    </div>
  </div>

  <div class="row">
<table class="table table-bordered border-primary table-hover table-sm posts_table">
  <thead class="thead-dark">
    <tr>
      <th scope="col" style="width: 700px">お気に入り記事</th>
      <th scope="col">投稿日</th>
      <th scope="col">更新日時</th>
    </tr>
  </thead>
  <tbody>
　　　<!-- 追加 -->
      <% @favorite_posts.each do |post| %>
        <tr>
            <td><%= link_to post.title, post_path(post.id) %></td>
            <td><%= post.created_at.strftime('%Y/%m/%d %H:%M') %></td>
            <td><%= post.updated_at.strftime('%Y/%m/%d %H:%M') %></td>
        </tr>
      <% end %>
  </tbody>
</table>

</div>
    </div>
  </div>
</div>
